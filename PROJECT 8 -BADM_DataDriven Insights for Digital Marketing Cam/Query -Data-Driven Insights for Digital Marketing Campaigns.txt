create database DIGITAL_MARKETING_GA_DATASET;

USE DIGITAL_MARKETING_GA_DATASET;

CREATE TABLE USER_ACQUISITION(
ID INT AUTO_INCREMENT PRIMARY KEY,
CHANNEL_GROUP VARCHAR(50),
NEW_USERS INT,
ENGAGED_SESSIONS INT,
ENGAGEMENT_RATE FLOAT,
ENGAGED_SESSIONS_PER_USER FLOAT,
AVERAGE_ENGAGEMENT_TIME VARCHAR(10),
COST FLOAT,
IMPRESSIONS INT,
EVENT_COUNT INT,
KEY_EVENTS INT,
TOTAL_REVENUE FLOAT
);

CREATE TABLE TRAFFIC_ACQUISITION(
ID INT AUTO_INCREMENT PRIMARY KEY,
CHANNEL_GROUP VARCHAR(50),
USERS INT,
SESSIONS INT,
ENGAGED_SESSION INT,
AVERAGE_ENGAGEMENT_TIME VARCHAR(10),
ENGAGED_SESSION_PER_USER FLOAT,
EVENTS_PER_SESSION FLOAT,
ENGAGEMENT_RATE FLOAT,
EVENT_COUNT INT,
KEY_EVENTS INT,
TOTAL_REVENUE FLOAT
);

CREATE TABLE EVENTS (
ID INT AUTO_INCREMENT PRIMARY KEY,
EVENT_NAME VARCHAR(100),
EVENT_COUNT INT,
TOTAL_USERS INT,
EVENT_COUNT_PER_USER FLOAT,
TOTAL_REVENUE FLOAT
);

CREATE TABLE LANDING_PAGE(
ID INT AUTO_INCREMENT PRIMARY KEY,
LANDING_PAGE VARCHAR(255),
SESSIONS INT,
USERS INT,
NEW_USERS INT,
AVERAGE_ENGAGEMENT_TIME_PER_SESSION VARCHAR(10),
KEY_EVENTS INT,
TOTAL_REVENUE FLOAT
);

CREATE TABLE RETENTION_OVERVIEW(
ID INT AUTO_INCREMENT PRIMARY KEY,
COHORT_PERIOD VARCHAR(20),
NEW_USERS INT,
RETAINED_USERS INT,
RETENTION_RATE FLOAT
);

CREATE TABLE AUDIENCE(
ID INT AUTO_INCREMENT PRIMARY KEY,
AUDIENCE_NAME VARCHAR(100),
USERS INT,
NEW_USERS INT,
SESSIONS INT,
VIEW_PER_SESSION FLOAT,
AVERAGE_SESSION_DURATION VARCHAR(10),
TOTAL_REVENUE FLOAT
);

CREATE TABLE DEMOGRAPHIC_COUNTRY(
ID INT AUTO_INCREMENT PRIMARY KEY,
COUNTRY VARCHAR(50),
USERS INT,
NEW_USERS INT,
ENGAGED_SESSIONS INT,
ENGAGEMENT_RATE FLOAT,
ENGAGED_SESSION_PER_USER FLOAT,
AVERAGE_ENGAGEMENT_TIME VARCHAR(10),
EVENT_COUNT INT,
KEY_EVENTS INT,
TOTAL_REVENUE FLOAT
);

CREATE TABLE DEMOGRAPHIC_AGE(
ID INT AUTO_INCREMENT PRIMARY KEY,
AGE_GROUP VARCHAR(20),
USERS INT,
NEW_USERS INT,
ENGAGED_SESSIONS INT,
ENGAGEMENT_RATE FLOAT,
ENGAGED_SESSION_PER_USER FLOAT,
AVAERAGE_ENGAGEMENT_TIME VARCHAR(10),
EVENT_COUNT INT,
KEY_EVENTS INT,
TOTAL_REVENUE FLOAT
);

CREATE TABLE DEMOGRAPHIC_INTRESTS(
ID INT AUTO_INCREMENT PRIMARY KEY,
INTREST_CATEGORY VARCHAR(20),
USERS INT,
NEW_USERS INT,
ENGAGED_SESSIONS INT,
ENGAGEMENT_RATE FLOAT,
ENGAGED_SESSION_PER_USER FLOAT,
AVAERAGE_ENGAGEMENT_TIME VARCHAR(10),
EVENT_COUNT INT,
KEY_EVENTS INT,
TOTAL_REVENUE FLOAT
);

CREATE TABLE DEMOGRAPHIC_GENDER(
ID INT AUTO_INCREMENT PRIMARY KEY,
GENDER VARCHAR(20),
USERS INT,
NEW_USERS INT,
ENGAGED_SESSIONS INT,
ENGAGEMENT_RATE FLOAT,
ENGAGED_SESSION_PER_USER FLOAT,
AVAERAGE_ENGAGEMENT_TIME VARCHAR(10),
EVENT_COUNT INT,
KEY_EVENTS FLOAT,
TOTAL_REVENUE FLOAT
);

SHOW VARIABLES LIKE 'SECURE_FILE_PRIV';

SET GLOBAL LOCAL_INFILE = 1;

LOAD DATA LOCAL INFILE 'C:/Users/kanan/Downloads/porject 7/CSV'
INTO TABLE DEMOGRAPHIC_GENDER
FIELDS TERMINATED BY ','
ENCLOSED BY '"'
LINES TERMINATED BY '\N'
IGNORE 1 ROWS;

ALTER TABLE USER_ACQUISITION
MODIFY COLUMN ENGAGEMENT_RATE DECIMAL(5,4),  -- More precision for percentage values
MODIFY COLUMN ENGAGED_SESSIONS_PER_USER DECIMAL(5,4),  -- Prevent rounding issues in ratios
MODIFY COLUMN AVERAGE_ENGAGEMENT_TIME INT,  -- Should be INT if it represents time in seconds
MODIFY COLUMN COST DECIMAL(10,2),  -- Use DECIMAL instead of FLOAT for precise financial data
MODIFY COLUMN TOTAL_REVENUE DECIMAL(10,2);  -- Use DECIMAL for accuracy;

DESC USER_ACQUISITION;

SELECT * FROM USER_ACQUISITION;

ALTER TABLE TRAFFIC_ACQUISITION
MODIFY COLUMN ENGAGED_SESSION_PER_USER DECIMAL(5,4),
MODIFY COLUMN EVENTS_PER_SESSION DECIMAL(5,4),
MODIFY COLUMN ENGAGEMENT_RATE DECIMAL(5,4),
MODIFY COLUMN AVERAGE_ENGAGEMENT_TIME INT,
MODIFY COLUMN TOTAL_REVENUE DECIMAL(10,2);

SELECT * FROM  TRAFFIC_ACQUISITION;

ALTER TABLE EVENTS
MODIFY COLUMN EVENT_COUNT_PER_USER DECIMAL(5,4),
MODIFY COLUMN TOTAL_REVENUE DECIMAL(10,2);

SELECT * FROM EVENTS;

DESC EVENTS;

ALTER TABLE LANDING_PAGE
MODIFY COLUMN AVERAGE_ENGAGEMENT_TIME_PER_SESSION INT,
MODIFY COLUMN TOTAL_REVENUE DECIMAL(10,2);

DESC LANDING_PAGE;

SELECT * FROM LANDING_PAGE;

ALTER TABLE AUDIENCE
MODIFY COLUMN VIEW_PER_SESSION DECIMAL(5,2),
MODIFY COLUMN AVERAGE_SESSION_DURATION INT,
MODIFY COLUMN TOTAL_REVENUE DECIMAL(10,2);

SELECT * FROM AUDIENCE;

ALTER TABLE DEMOGRAPHIC_COUNTRY
MODIFY COLUMN ENGAGEMENT_RATE DECIMAL(5,4),
MODIFY COLUMN ENGAGED_SESSION_PER_USER DECIMAL(5,4),
MODIFY COLUMN AVERAGE_ENGAGEMENT_TIME INT,
MODIFY COLUMN TOTAL_REVENUE DECIMAL(10,2);

SELECT * FROM DEMOGRAPHIC_COUNTRY;

ALTER TABLE DEMOGRAPHIC_AGE
CHANGE COLUMN AVAERAGE_ENGAGEMENT_TIME AVERAGE_ENGAGEMENT_TIME INT,
MODIFY COLUMN ENGAGEMENT_RATE DECIMAL(5,4),
MODIFY COLUMN ENGAGED_SESSION_PER_USER DECIMAL(5,4),
MODIFY COLUMN TOTAL_REVENUE DECIMAL(10,2);

SELECT * FROM DEMOGRAPHIC_AGE;

DESC DEMOGRAPHIC_INTRESTS;

ALTER TABLE DEMOGRAPHIC_INTRESTS
MODIFY COLUMN ENGAGEMENT_RATE DECIMAL(5,4),
MODIFY COLUMN ENGAGED_SESSION_PER_USER DECIMAL(5,4),
MODIFY COLUMN TOTAL_REVENUE DECIMAL(10,2);

SELECT * FROM DEMOGRAPHIC_INTRESTS;

ALTER TABLE DEMOGRAPHIC_GENDER
CHANGE COLUMN AVAERAGE_ENGAGEMENT_TIME AVERAGE_ENGAGEMENT_TIME INT,
MODIFY COLUMN ENGAGEMENT_RATE DECIMAL(5,4),
MODIFY COLUMN ENGAGED_SESSION_PER_USER DECIMAL(5,4),
MODIFY COLUMN KEY_EVENTS INT,
MODIFY COLUMN TOTAL_REVENUE DECIMAL(10,2);

SELECT * FROM DEMOGRAPHIC_GENDER;

ALTER TABLE RETENTION_OVERVIEW  
MODIFY COLUMN RETENTION_RATE DECIMAL(5,2),  
ADD COLUMN CHANNEL_GROUP VARCHAR(50),  
MODIFY COLUMN COHORT_PERIOD VARCHAR(30),  
RENAME COLUMN NEW_USERS TO TOTAL_NEW_USERS;  

DESC RETENTION_OVERVIEW;

SELECT * FROM RETENTION_OVERVIEW;

ALTER TABLE RETENTION_OVERVIEW
DROP COLUMN CHANNEL_GROUP;

SELECT CHANNEL_GROUP, 
SUM(USERS) AS TOTAL_USERS, 
ROUND(AVG(ENGAGEMENT_RATE) * 100, 2) AS ENGAGEMENT_RATE_PERCENT,
SUM(SESSIONS) AS TOTAL_SESSIONS,
SUM(ENGAGED_SESSION) AS TOTAL_ENGAGED_SESSIONS
FROM TRAFFIC_ACQUISITION
GROUP BY CHANNEL_GROUP
ORDER BY TOTAL_USERS DESC;

SELECT CHANNEL_GROUP, 
SUM(`ENGAGED_SESSION`) AS TOTAL_ENGAGED_SESSIONS, 
ROUND(AVG(AVERAGE_ENGAGEMENT_TIME), 2) AS AVG_ENGAGEMENT_TIME
FROM TRAFFIC_ACQUISITION
GROUP BY CHANNEL_GROUP
ORDER BY AVG_ENGAGEMENT_TIME DESC;

SELECT CHANNEL_GROUP, 
SUM(KEY_EVENTS) AS TOTAL_CONVERSIONS, 
ROUND((SUM(KEY_EVENTS) * 100.0 / NULLIF(SUM(ENGAGED_SESSION), 0)), 2) AS CONVERSION_RATE_PERCENT, 
SUM(TOTAL_REVENUE) AS TOTAL_REVENUE
FROM TRAFFIC_ACQUISITION
GROUP BY CHANNEL_GROUP
ORDER BY CONVERSION_RATE_PERCENT DESC;

SELECT 
    CHANNEL_GROUP, 
    SUM(IMPRESSIONS) AS TOTAL_IMPRESSIONS, 
    SUM(KEY_EVENTS) AS TOTAL_CONVERSIONS, 
    ROUND((SUM(KEY_EVENTS) * 100.0 / NULLIF(SUM(IMPRESSIONS), 0)), 2) AS CTR_PERCENT, 
    SUM(COST) AS TOTAL_AD_COST, 
    SUM(TOTAL_REVENUE) AS TOTAL_REVENUE, 
    ROUND((SUM(TOTAL_REVENUE) - SUM(COST)) / NULLIF(SUM(COST), 0) * 100, 2) AS ROI_PERCENT, 
    ROUND(SUM(COST) / NULLIF(SUM(ENGAGED_SESSIONS), 0), 2) AS CPC, 
    ROUND(SUM(COST) / NULLIF(SUM(KEY_EVENTS), 0), 2) AS CPA
FROM USER_ACQUISITION 
GROUP BY CHANNEL_GROUP
ORDER BY CTR_PERCENT DESC;

SELECT COHORT_PERIOD, 
       SUM(TOTAL_NEW_USERS) AS NEW_USERS, 
       SUM(RETAINED_USERS) AS RETAINED_USERS, 
       ROUND(AVG(RETENTION_RATE) * 100, 2) AS AVG_RETENTION_RATE
FROM RETENTION_OVERVIEW
GROUP BY COHORT_PERIOD
ORDER BY COHORT_PERIOD;

SHOW DATABASES;

SELECT @@SERVERNAME, SERVERPROPERTY('InstanceName');

SELECT user, host, authentication_string FROM mysql.user;


